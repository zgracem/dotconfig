# -----------------------------------------------------------------------------
# start GPG agent
# -----------------------------------------------------------------------------

# stop sourcing if gpg-agent isn't in $PATH
if ! _inPath gpg-agent; then
    return
fi

# to set the environment variable with socket and PID
gpg_env=$HOME/.gnupg/gpg-agent.environment

_gpg_agent_is_running()
{   # return 0 if the agent is already running

    declare gpg_pid=$(echo $GPG_AGENT_INFO | cut -d: -f2)

    if [[ -n $gpg_pid ]]; then
        command ps -p "$gpg_pid" &>/dev/null
        return $?
    else
        return 1
    fi
}

# -----------------------------------------------------------------------------

if ! _gpg_agent_is_running; then
    gpg-agent --batch --daemon --quiet >| "$gpg_env"
                                        # start the agent
    . "$gpg_env" &>/dev/null            # set & export $GPG_AGENT_INFO
    export GPG_TTY=$(tty)               # for PIN entry program, if any
fi
